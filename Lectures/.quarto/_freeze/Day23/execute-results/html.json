{
  "hash": "61010cc54379d7a5579fdd45cbe2399b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Cross Validation and Linear Regression\"\ntitle-slide-attributes:\n  data-background-image: images/lake.jpg\n  data-background-size: contain\n  data-background-opacity: \"0.5\"\nsubtitle: \"STAT 220\"\nauthor: \"Bastola\"\nformat:\n  revealjs: \n    theme: [default, scss/main.scss]\n    slide_level: 2\n    slide-number: true\n    preview-links: auto\n    history: true\n    chalkboard: true\n    transition: slide\n    background-transition: fade    \n    touch: false\n    controls: true\nfilters:\n  - shinylive\n  - webr\n---\n\n\n\n\n\n\n\n## Resampling methods\n\n<center>\n<img src=\"images/resampling.png\" style=\"width:60%; height:auto;\"> <br>\n</center>\n\nCreate a series of data sets similar to the training/testing split, always used with the training set\n\n\n[[Kuhn and Johnson (2019)](https://bookdown.org/max/FES/resampling.html)]{.footer}\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n\n## Why not to use single (training) test set\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](Day23_files/figure-revealjs/unnamed-chunk-3-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n---\n\n## Cross validation\n\n![](images/k-folds.png)\n\nIdea: Split the training data up into multiple training-validation pairs, evaluate the classifier on each split and average the performance metrics\n\n\n[Image courtesy of Dennis Sun]{.footer}\n\n\n\n## k-fold cross validation\n\n::: cle\n::: font80\n\n1. split the data into $k$ subsets\n\n2. combine the first $k-1$ subsets into a training set and train the classifier\n\n3. evaluate the model predictions on the last (i.e. $k$th) held-out subset\n\n4. repeat steps 2-3 $k$ times (i.e. $k$ \"folds\"), each time holding out a different one of the $k$ subsets\n\n5. calculate performance metrics from each validation set\n\n6. average each metric over the $k$ folds to come up with a single estimate of that metric\n\n:::\n:::\n\n\n<!--\n\n##\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](Day23_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=75%}\n:::\n:::\n\n\n\n\nBased on accuracy, $k=4$ appears best, We can look at other metrics. Notice that accuracy doesn't always decrease with $k$\n\n-->\n\n::: middle-align-xy\n\n## 5-fold cross validation\n\n::: eqt\n\nCreating the recipe\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n:::\n:::\n\n## 5-fold cross validation\n\n::: eqt\n\nCreate your model specification and use `tune()` as a placeholder for the number of neighbors\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\nSplit the `fire_train` data set into `v = 5` folds, stratified by `classes`\n\n\n\n::: {.cell}\n\n:::\n\n\n\n:::\n\n## 5-fold cross validation\n\n::: eqt\n\nCreate a grid of $K$ values, the number of neighbors\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\nRun 5-fold CV on the `k_vals` grid, storing four performance metrics\n\n\n\n::: {.cell}\n\n:::\n\n\n\n:::\n\n## Choosing K\n\n::: eqt\n\nCollect the performance metrics \n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 7\n  neighbors .metric     .estimator  mean     n std_err .config              \n      <dbl> <chr>       <chr>      <dbl> <int>   <dbl> <chr>                \n1         1 accuracy    binary     0.987    50 0.00343 Preprocessor1_Model01\n2         1 ppv         binary     0.999    50 0.00133 Preprocessor1_Model01\n3         1 sensitivity binary     0.979    50 0.00586 Preprocessor1_Model01\n4         1 specificity binary     0.998    50 0.002   Preprocessor1_Model01\n5         2 accuracy    binary     0.987    50 0.00343 Preprocessor1_Model02\n6         2 ppv         binary     0.999    50 0.00133 Preprocessor1_Model02\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Choosing K\n\n::: eqt\n\nCollect the performance metrics and find the best model\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 20 × 7\n# Groups:   .metric [4]\n   neighbors .metric     .estimator  mean     n std_err .config              \n       <dbl> <chr>       <chr>      <dbl> <int>   <dbl> <chr>                \n 1         1 accuracy    binary     0.987    50 0.00343 Preprocessor1_Model01\n 2         2 accuracy    binary     0.987    50 0.00343 Preprocessor1_Model02\n 3        11 ppv         binary     1        50 0       Preprocessor1_Model11\n 4        12 ppv         binary     1        50 0       Preprocessor1_Model12\n 5        13 ppv         binary     1        50 0       Preprocessor1_Model13\n 6        14 ppv         binary     1        50 0       Preprocessor1_Model14\n 7        15 ppv         binary     1        50 0       Preprocessor1_Model15\n 8        16 ppv         binary     1        50 0       Preprocessor1_Model16\n 9        17 ppv         binary     1        50 0       Preprocessor1_Model17\n10        18 ppv         binary     1        50 0       Preprocessor1_Model18\n11         1 sensitivity binary     0.979    50 0.00586 Preprocessor1_Model01\n12         2 sensitivity binary     0.979    50 0.00586 Preprocessor1_Model02\n13        11 specificity binary     1        50 0       Preprocessor1_Model11\n14        12 specificity binary     1        50 0       Preprocessor1_Model12\n15        13 specificity binary     1        50 0       Preprocessor1_Model13\n16        14 specificity binary     1        50 0       Preprocessor1_Model14\n17        15 specificity binary     1        50 0       Preprocessor1_Model15\n18        16 specificity binary     1        50 0       Preprocessor1_Model16\n19        17 specificity binary     1        50 0       Preprocessor1_Model17\n20        18 specificity binary     1        50 0       Preprocessor1_Model18\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Choosing K: Visualization\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](Day23_files/figure-revealjs/unnamed-chunk-12-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n\n\n## The full process\n<center>\n![](images/cv-5.png)\n</center>\n\n[Image source: [rafalab.github.io/dsbook/](rafalab.github.io/dsbook/)]{.footer}\n\n\n\n::: centered-content\n\n## <i class=\"fa fa-pencil-square-o\" style=\"font-size:48px;color:purple\"> Group Activity 1</i> {background=\"#ffdf9e\"}\n\n::: row\n::: left\n![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)\n:::\n\n::: right\n\n<br>\n\n::: lqt\n\n- Please clone the `ca23-yourusername` repository from  [Github](https://github.com/DataScienceSpring24)\n- Please do problem 1 in the class activity for today\n:::\n:::\n:::\n\n`<div class=\"countdown\" id=\"timer_1fe570bf\" data-update-every=\"1\" tabindex=\"0\" style=\"top:0;left:0;padding:3px 4px;font-size:1em;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>`{=html}\n:::\n\n\n\n## Supervised Learning \n\n<br>\n\n::: zen\n\n- *Supervised learning:* Learning a function that maps an input to an output based on example `inputoutput` pairs.\n- *Function:* $\\mathrm{y}=\\mathrm{f}(\\mathrm{x})$, where $\\mathrm{y}$ is the label (output) we predict, and $\\mathrm{x}$ is the feature(s) (input).\n- **Goal:** Find a function that calculates $y$ from $x$ values accurately for all cases in the training dataset.\n\n:::\n\n## Linear Regression: The Basics\n\n::: cle\n::: font70\n\nLinear regression fits a linear equation to observed data to describe the relationship between variables.\n\n $$y=\\beta_0 + \\beta_1x_1 + \\beta_2x_2 + \\cdots + \\epsilon$$\n\n- $y$ is the dependent variable (what we're trying to predict),\n- $x_1, x_2, \\cdots$ are independent variables (features),\n- $\\beta_0, \\beta_1, \\beta_2, \\cdots$ are coefficients, and $\\epsilon$ represents the error term.\n\n\nObjective: Minimize the differences between the observed values and the values predicted by the linear equation.\n\n:::\n:::\n\n## Relevant Metrics\n\n::: vvt\n\n$$\\text{MSE} =\\frac{1}{n} \\sum_{i=1}^n\\left(y_i-\\hat{y}_i\\right)^2$$\n\n\n$$\\text{RMSE} =\\sqrt{\\frac{1}{n} \\sum_{i=1}^n\\left(y_i-\\hat{y}_i\\right)^2}$$\n\n$$R^2 = 1 - \\frac{\\sum_{i=1}^{n} (y_i - \\hat{y}_i)^2}{\\sum_{i=1}^{n} (y_i - \\overline{y})^2}$$\n\n\n:::\n\n\n## Case study: Bike Share Scheme\n\n::: scroll-box-24\n\nData from a real study on a bicycle sharing scheme was collected to predict rental numbers based on seasonality and weather conditions.\n\n::: hscroll\n\n\n\n\n|season |yr |mnth |holiday |weekday |workingday |weathersit |     temp|    atemp|      hum| windspeed| rentals|\n|:------|:--|:----|:-------|:-------|:----------|:----------|--------:|--------:|--------:|---------:|-------:|\n|1      |0  |1    |0       |6       |0          |2          | 0.344167| 0.363625| 0.805833|  0.160446|     331|\n|1      |0  |1    |0       |0       |0          |2          | 0.363478| 0.353739| 0.696087|  0.248539|     131|\n|1      |0  |1    |0       |1       |1          |1          | 0.196364| 0.189405| 0.437273|  0.248309|     120|\n|1      |0  |1    |0       |2       |1          |1          | 0.200000| 0.212122| 0.590435|  0.160296|     108|\n|1      |0  |1    |0       |3       |1          |1          | 0.226957| 0.229270| 0.436957|  0.186900|      82|\n\n\n\n:::\n:::\n\n##\n\n::: font50\n\n| Variable        | Description |\n|--------------|-------------|\n| instant      | An identifier for each unique row |\n| season       | Encoded numerical value for the season (1 for spring, 2 for summer, 3 for fall, 4 for winter) |\n| yr           | Observation year in the study, spanning two years (0 for 2011, 1 for 2012) |\n| mnth         | Month of observation, numbered from 1 (January) to 12 (December) |\n| holiday      | Indicates if the observation was on a public holiday (binary value) |\n| weekday      | Day of the week of the observation (0 for Sunday to 6 for Saturday) |\n| workingday   | Indicates if the day was a working day (binary value, excluding weekends and holidays) |\n| weathersit   | Weather condition category (1 for clear, 2 for mist/cloud, 3 for light rain/snow, 4 for heavy rain/hail/snow/fog) |\n| temp         | Normalized temperature in Celsius |\n| atemp        | Normalized \"feels-like\" temperature in Celsius |\n| hum          | Normalized humidity level |\n| windspeed    | Normalized wind speed |\n| rentals      | Count of bicycle rentals recorded |\n\n:::\n\n##\n\n::: panel-tabset\n\n### Descriptive Statistics\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|variable  |     Min.|    1st Qu.|     Median|       Mean|     3rd Qu.|        Max.|\n|:---------|--------:|----------:|----------:|----------:|-----------:|-----------:|\n|atemp     | 0.079070|   0.337842|   0.486733|   0.474354|    0.608602|    0.840896|\n|temp      | 0.059130|   0.337083|   0.498333|   0.495385|    0.655417|    0.861667|\n|hum       | 0.000000|   0.520000|   0.626667|   0.627894|    0.730209|    0.972500|\n|windspeed | 0.022392|   0.134950|   0.180975|   0.190486|    0.233214|    0.507463|\n|rentals   | 2.000000| 315.500000| 713.000000| 848.176471| 1096.000000| 3410.000000|\n\n\n:::\n:::\n\n\n\n\n### Code\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n:::\n\n\n##\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](Day23_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n##\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](Day23_files/figure-revealjs/unnamed-chunk-17-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n## Data preparation and train-test split\n\n::: eqt\n\n\n\n::: {.cell}\n\n:::\n\n\n\n:::\n\n## \n\n::: eqt\n\nModel specification\n\n\n\n::: {.cell}\n\n:::\n\n\n\nFit the model\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n| r.squared| adj.r.squared|    sigma| statistic| p.value| df|    logLik|      AIC|      BIC| deviance| df.residual| nobs|\n|---------:|-------------:|--------:|---------:|-------:|--:|---------:|--------:|--------:|--------:|-----------:|----:|\n| 0.6956614|     0.6798592| 385.1778|  44.02308|       0| 27| -4025.838| 8109.677| 8234.559| 77148225|         520|  548|\n\n\n:::\n:::\n\n\n\n:::\n\n\n## Predict on test data\n\n::: eqt\n::: font90\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  rentals .pred\n    <dbl> <dbl>\n1     331 963. \n2     131 778. \n3     148  93.8\n4     251 779. \n5      75 -86.4\n6     150 484. \n```\n\n\n:::\n:::\n\n\n\n:::\n:::\n\n## Evaluate the model\n\n::: eqt\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  .metric .estimate\n  <chr>       <dbl>\n1 rmse      380.   \n2 rsq         0.710\n```\n\n\n:::\n:::\n\n\n\n:::\n\n##\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](Day23_files/figure-revealjs/unnamed-chunk-25-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n\n::: centered-content\n\n## <i class=\"fa fa-pencil-square-o\" style=\"font-size:48px;color:purple\"> Group Activity 2</i> {background=\"#ffdf9e\"}\n\n::: row\n::: left\n![](https://media.giphy.com/media/RKApDdwsQ6jkwd6RNn/giphy.gif)\n:::\n\n::: right\n\n<br>\n\n::: lqt\n\n- Please finish the remaining problems in the class activity for today\n\n:::\n:::\n:::\n\n`<div class=\"countdown\" id=\"timer_416c46d6\" data-update-every=\"1\" tabindex=\"0\" style=\"top:0;left:0;padding:3px 4px;font-size:1em;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>`{=html}\n:::\n\n",
    "supporting": [
      "Day23_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"Day23_files/libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"Day23_files/libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}